spring:
  application:
    name: finance-admin-management-test
  
  # Test Database Configuration
  datasource:
    url: jdbc:h2:mem:testdb;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE;MODE=PostgreSQL;DATABASE_TO_LOWER=TRUE;DEFAULT_NULL_ORDERING=HIGH
    username: sa
    password: 
    driver-class-name: org.h2.Driver
    
  # JPA Configuration for Tests
  jpa:
    hibernate:
      ddl-auto: create-drop
      naming:
        physical-strategy: org.hibernate.boot.model.naming.PhysicalNamingStrategyStandardImpl
        implicit-strategy: org.hibernate.boot.model.naming.ImplicitNamingStrategyLegacyJpaImpl
    show-sql: false
    properties:
      hibernate:
        dialect: com.finance.admin.config.CustomH2Dialect
        format_sql: false
        use_sql_comments: false
        globally_quoted_identifiers: false
        enable_lazy_load_no_trans: true
        hbm2ddl:
          auto: create-drop
    generate-ddl: true
    defer-datasource-initialization: true
    open-in-view: false
    database-platform: com.finance.admin.config.CustomH2Dialect
    
  # SQL Initialization
  sql:
    init:
      mode: always
      data-locations: classpath:test-data.sql
      schema-locations: classpath:test-schema.sql
      platform: h2
      continue-on-error: false
      
  # H2 Console for debugging
  h2:
    console:
      enabled: true
      path: /h2-console
      
  # Exclude external services for testing
  autoconfigure:
    exclude:
      - org.springframework.boot.autoconfigure.data.redis.RedisAutoConfiguration
      - org.springframework.boot.autoconfigure.data.mongo.MongoDataAutoConfiguration
      - org.springframework.boot.autoconfigure.mongo.MongoAutoConfiguration
      - org.springframework.boot.autoconfigure.amqp.RabbitAutoConfiguration
      - org.springframework.boot.autoconfigure.mail.MailSenderAutoConfiguration
      - org.springframework.boot.autoconfigure.security.oauth2.client.servlet.OAuth2ClientAutoConfiguration
    
  # Main configuration
  main:
    allow-bean-definition-overriding: true
    allow-circular-references: true
    lazy-initialization: true

  # Disable email for tests
  mail:
    enabled: false
    host: localhost
    port: 3025
    username: test
    password: test

# Test-specific Application Configuration
app:
  jwt:
    secret: test-secret-key-for-jwt-token-generation-in-tests
    expiration: 3600000
  
  security:
    allowed-ips: 127.0.0.1,::1,192.168.1.0/24
    max-failed-attempts: 3
    lockout-duration: 60000 # 1 minute for tests
    session-timeout: 300000 # 5 minutes for tests
    
  audit:
    retention-days: 7 # Shorter retention for tests
    cleanup-schedule: "0 0 1 * * ?" # Daily at 1 AM
    
  encryption:
    key: testEncryptionKeyForAESGCMMustBe256BitsLongForDataSecurityTesting123456789012345

  # Disable email features for tests
  email:
    enabled: false
    smtp:
      enabled: false
  
  certificate:
    email:
      enabled: false

# Logging Configuration
logging:
  level:
    root: WARN
    org.springframework: WARN
    org.springframework.security: INFO
    org.springframework.test: INFO
    org.springframework.boot.test: INFO
    org.springframework.transaction: WARN
    org.springframework.orm.jpa: WARN
    org.springframework.data.jpa: WARN
    org.hibernate: WARN
    org.hibernate.SQL: WARN
    org.hibernate.type.descriptor.sql.BasicBinder: WARN
    com.finance.admin: INFO
    com.zaxxer.hikari: WARN
  pattern:
    console: "%d{HH:mm:ss.SSS} [%thread] %-5level %logger{36} - %msg%n"

# Disable actuator endpoints in tests
management:
  endpoints:
    enabled-by-default: false
  endpoint:
    health:
      enabled: true
  metrics:
    export:
      prometheus:
        enabled: false

# Server configuration for tests
server:
  port: 0 # Random port for tests
  error:
    include-message: always
    include-binding-errors: always
    include-stacktrace: never
    include-exception: false

# Test-specific Jackson configuration
spring.jackson:
  default-property-inclusion: NON_NULL
  serialization:
    write-dates-as-timestamps: false
  deserialization:
    fail-on-unknown-properties: false

# Disable Flyway for tests
flyway:
  enabled: false

# AWS Configuration for Tests
aws:
  s3:
    endpoint: http://localhost:4566
    region: us-east-1
    bucket: test-bucket
    
# Security Configuration for Tests
security:
  jwt:
    secret: test-secret-key-for-jwt-token-generation-in-tests
    expiration: 3600000

# RabbitMQ Configuration for Tests
rabbitmq:
  host: localhost
  port: 5672
  username: guest
  password: guest

# MongoDB Configuration for Tests
data:
  mongodb:
    host: localhost
    port: 27017
    database: test
    
# Redis Configuration for Tests
redis:
  host: localhost
  port: 6379
